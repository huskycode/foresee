// Generated by CoffeeScript 1.4.0
var StoriesCtrl, countVoted, getCardFace, populateCards;

getCardFace = function(displayNumbers, val) {
  if (val === null) {
    return "-";
  } else if (displayNumbers) {
    return val;
  } else {
    return "?";
  }
};

countVoted = function(votes) {
  var n, names, total, _i, _len;
  names = Object.keys(votes);
  total = 0;
  for (_i = 0, _len = names.length; _i < _len; _i++) {
    n = names[_i];
    if (votes[n] !== null) {
      total++;
    }
  }
  return total;
};

populateCards = function(votes) {
  var displayNumbers, n, names, namesCount, result, votedCount, _i, _len;
  names = Object.keys(votes);
  namesCount = names.length;
  votedCount = countVoted(votes);
  displayNumbers = namesCount === votedCount;
  result = "";
  for (_i = 0, _len = names.length; _i < _len; _i++) {
    n = names[_i];
    result += "<div class='card_holder'><div class='card'>" + getCardFace(displayNumbers, votes[n]) + "</div>" + n + "</div>";
  }
  result += "<div style='clear:both'></div>";
  return $("#cards").html(result);
};

$(function() {
  var i, roomId, socket, socketUrl, url, votes;
  url = $("#url").val();
  socketUrl = $("#socketUrl").val();
  roomId = $("#roomId").val();
  votes = {};
  socket = io.connect(socketUrl);
  socket.emit("ask", {
    room: roomId
  });
  socket.on('voteRefresh', function(data) {
    var participantNames;
    if (data.room === roomId) {
      votes = data.votes;
      participantNames = Object.keys(data.votes);
      $("#participantsCount").html(participantNames.length);
      return populateCards(data.votes);
    }
  });
  i = 0;
  $("#link").click(function() {
    var left, top;
    top = 0 + (550 * (i % 2));
    left = 25 + (330 * Math.floor(i / 2));
    window.open(url, "Join" + (i++), "width=320,height=480,top=" + top + ",left=" + left + ",toolbar=0,resizable=0,menubar=0", false);
    return false;
  });
  return $("#btn").click(function() {
    return socket.emit('my other event', {
      my: 'data'
    });
  });
});